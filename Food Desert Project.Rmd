---
title: "Food Deserts in the United States"
author: "Team B"
date: "7/28/2020"
output: 
  html_document:
   code_folding: hide
   number_sections: true
   toc: yes
   toc_depth: 3
   toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r setup, include=FALSE}
# use this function to conveniently load libraries and work smoothly with knitting
# can add quietly=T option to the require() function
# the loadPkg function essentially replaced/substituted two functions install.packages() and library() in one step.
loadPkg = function(x) { if (!require(x,character.only=T, quietly =T)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T)) stop("Package not found") } }

# unload/detact package when done using it
unloadPkg = function(pkg, character.only = FALSE) { 
  if(!character.only) { pkg <- as.character(substitute(pkg)) } 
  search_item <- paste("package", pkg,sep = ":") 
  while(search_item %in% search()) { detach(search_item, unload = TRUE, character.only = TRUE) } 
}
```


```{r xkablesummary}
loadPkg("xtable")
loadPkg("kableExtra")
loadPkg("stringi")
loadPkg("leaps")
loadPkg("ggplot2")
loadPkg("ggmap")
loadPkg("ISLR")
loadPkg("faraway")
loadPkg("tigris")
loadPkg("acs")
loadPkg("stringr") 
loadPkg("ggpubr")
loadPkg("dplyr")
loadPkg("leaps")
loadPkg("MASS")

xkabledply = function(modelsmmrytable, title="Table", digits = 4, pos="left", bso="striped", wide=FALSE) { 
  #' Combining base::summary, xtable, and kableExtra, to easily display model summary. 
  #' wrapper for the base::summary function on model objects
  #' Can also use as head for better display
  #' ELo 202004 GWU DATS
  #' version 1.2
  #' @param modelsmmrytable This can be a generic table, a model object such as lm(), or the summary of a model object summary(lm()) 
  #' @param title Title of table. 
  #' @param digits Number of digits to display
  #' @param pos Position of table, c("left","center","right") 
  #' @param bso bootstrap_options = c("basic", "striped", "bordered", "hover", "condensed", "responsive")
  #' @param wide print table in long (FALSE) format or wide (TRUE) format
  #' @return HTML table for display
  #' @examples
  #' library("xtable")
  #' library("kableExtra")
  #' xkabledply( df, title="Table testing", pos="left", bso="hover" )
  #' xkabledply( ISLR::Hitters[1:5,] )
  if (wide) { modelsmmrytable <- t(modelsmmrytable) }
  modelsmmrytable %>%
    xtable() %>% 
    kable(caption = title, digits = digits) %>%
    kable_styling(bootstrap_options = bso, full_width = FALSE, position = pos)
}

xkabledplyhead = function(df, rows=5, title="Head", digits = 4, pos="left", bso="striped") { 
  xkabledply(df[1:rows, ], title, digits, pos, bso, wide=FALSE)
}

xkabledplytail = function(df, rows=5, title="Tail", digits = 4, pos="left", bso="striped") { 
  trows = nrow(df)
  xkabledply(df[ (trows-rows+1) : trows, ], title, digits, pos, bso, wide=FALSE)
}

xkablesummary = function(df, title="Table: Statistics summary.", digits = 4, pos="left", bso="striped") { 
  #' Combining base::summary, xtable, and kableExtra, to easily display numeric variable summary of dataframes. 
  #' ELo 202004 GWU DATS
  #' version 1.2
  #' @param df The dataframe.
  #' @param title Title of table. 
  #' @param digits Number of digits to display
  #' @param pos Position of table, c("left","center","right") 
  #' @param bso bootstrap_options = c("basic", "striped", "bordered", "hover", "condensed", "responsive")
  #' @return The HTML summary table for display, or for knitr to process into other formats 
  #' @examples
  #' xkablesummary( faraway::ozone )
  #' xkablesummary( ISLR::Hitters, title="Five number summary", pos="left", bso="hover"  )
  
  s = summary(df) %>%
    apply( 2, function(x) stringr::str_remove_all(x,c("Min.\\s*:\\s*","1st Qu.\\s*:\\s*","Median\\s*:\\s*","Mean\\s*:\\s*","3rd Qu.\\s*:\\s*","Max.\\s*:\\s*")) ) %>% # replace all leading words
    apply( 2, function(x) stringr::str_trim(x, "right")) # trim trailing spaces left
  
  colnames(s) <- stringr::str_trim(colnames(s))
  
  if ( dim(s)[1] ==6 ) { rownames(s) <- c('Min','Q1','Median','Mean','Q3','Max') 
  } else if ( dim(s)[1] ==7 ) { rownames(s) <- c('Min','Q1','Median','Mean','Q3','Max','NA') }
  
  xkabledply(s, title=title, digits = digits, pos=pos, bso=bso )
}

xkablevif = function(model, title="VIFs of the model", digits = 3, pos="left", bso="striped", wide=TRUE) { 
  #' Combining faraway::vif, xtable, and kableExtra, to easily display numeric summary of VIFs for a model. 
  #' ELo 202004 GWU DATS
  #' version 1.2
  #' @param model The lm or compatible model object.
  #' @param title Title of table. 
  #' @param digits Number of digits to display
  #' @param pos Position of table, c("left","center","right") 
  #' @param bso bootstrap_options = c("basic", "striped", "bordered", "hover", "condensed", "responsive")
  #' @param wide print table in long (FALSE) format or wide (TRUE) format
  #' @return The HTML summary table of the VIFs for a model for display, or for knitr to process into other formats 
  #' @examples
  #' xkablevif( lm(Salary~Hits+RBI, data=ISLR::Hitters, wide=T ) )
  
  vifs = table( names(model$coefficients)[2:length(model$coefficients)] ) # remove intercept to set column names
  vifs[] = faraway::vif(model) # set the values
  if (wide) { vifs <- t(vifs) }
  xkabledply( vifs, title=title, digits = digits, pos=pos, bso=bso )
}
```

```{r outlierKD2}
# Fix outliers
# Fix outliers
outlierKD2 <- function(df, var, rm=FALSE) { 
    #' Original outlierKD functino by By Klodian Dhana,
    #' https://www.r-bloggers.com/identify-describe-plot-and-remove-the-outliers-from-the-dataset/
    #' Modified to have third argument for removing outliers inwtead of interactive prompt, 
    #' and after removing outlier, original df will not be changed. The function returns the new df, 
    #' which can be saved as original df name if desired.
    #' Check outliers, and option to remove them, save as a new dataframe. 
    #' @param df The dataframe.
    #' @param var The variable in the dataframe to be checked for outliers
    #' @param rm Boolean. Whether to remove outliers or not.
    #' @return The dataframe with outliers replaced by NA if rm==TRUE, or df if nothing changed
    #' @examples
    #' outlierKD2(mydf, height, FALSE)
    #' mydf = outlierKD2(mydf, height, TRUE)
    #' mydfnew = outlierKD2(mydf, height, TRUE)
    dt = df # duplicate the dataframe for potential alteration
    var_name <- eval(substitute(var),eval(dt))
    na1 <- sum(is.na(var_name))
    m1 <- mean(var_name, na.rm = T)
    par(mfrow=c(2, 2), oma=c(0,0,3,0))
    boxplot(var_name, main="With outliers")
    hist(var_name, main="With outliers", xlab=NA, ylab=NA)
    outlier <- boxplot.stats(var_name)$out
    mo <- mean(outlier)
    var_name <- ifelse(var_name %in% outlier, NA, var_name)
    boxplot(var_name, main="Without outliers")
    hist(var_name, main="Without outliers", xlab=NA, ylab=NA)
    title("Outlier Check", outer=TRUE)
    na2 <- sum(is.na(var_name))
    cat("Outliers identified:", na2 - na1, "\n")
    cat("Propotion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name))*100, 1), "\n")
    cat("Mean of the outliers:", round(mo, 2), "\n")
    m2 <- mean(var_name, na.rm = T)
    cat("Mean without removing outliers:", round(m1, 2), "\n")
    cat("Mean if we remove outliers:", round(m2, 2), "\n")
    
    # response <- readline(prompt="Do you want to remove outliers and to replace with NA? [yes/no]: ")
    # if(response == "y" | response == "yes"){
    if(rm){
        dt[as.character(substitute(var))] <- invisible(var_name)
        #assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
        cat("Outliers successfully removed", "\n")
        return(invisible(dt))
    } else {
        cat("Nothing changed", "\n")
        return(invisible(df))
    }
}

# sample usage
# mlb2 = outlierKD2(mlb, weight, TRUE) # This will remove weight outliers, replace those values by NA, then save it as a new dataframe mlb2
# mlb = outlierKD2(mlb, weight, TRUE) # This will remove weight outliers, replace those values by NA, then REPLACE the dataframe mlb with the new one.
# outlierKD2(mlb, weight, FALSE) # This will NOT remove weight outliers, but it will show the charts with and without outliers nonetheless. 
# outlierKD2(mlb, weight) # same as above, as the last argument is optional, default = FALSE 
```


# Chapter 1: Introduction 
```{r}
food <- data.frame(read.csv("food.csv"))
food <- subset(food, POP2010 > 1)
food$State<-as.factor(food$State)
food$Region <- as.factor(food$Region)
food$Urban <- as.factor(food$Urban)
colnames(food)[8] <- c("Desert")
str(food)
```

# Chapter 2: Exploratory Data Analysis
### Here we are looking at the normality of our quantitative independent variables to assess whether or not we should exclude outliers when we build our model.
```{r Poverty Rate Normality}
# Poverty Rate Normality of Tracts
hist(food$PovertyRate, main="Histogram of Percentage of Tract at or Below Federal Poverty Rate", xlab="Poverty Rate", col="purple")
qqnorm(food$PovertyRate, main="Q-Q plot of Percentage of Tract at or Below Poverty Rate")
qqline(food$PovertyRate)
outlierKD2(food, PovertyRate, FALSE)
# The Poverty Rate is still slightly skewed to the right with and without outliers and the mean with outliers is about 16% and without outliers it is about 15% so this did not change much.

# Poverty Rate Normality of Tracts in Food Desert 
food.desert <- subset(food, Desert==1)
hist(food.desert$PovertyRate, main="Histogram of the Percentage of Tract at or Below Poverty Rate in a Food Desert", xlab= "Poverty Rate", col="blue")
qqnorm(food.desert$PovertyRate, main="Percentage of Tract in Food Desert at or Below Poverty Rate")
qqline(food.desert$PovertyRate)
outlierKD2(food.desert, PovertyRate, FALSE)
# When we subset our data to only census tracts that are located in food deserts the mean is 26.97 which means about 27% of households located in a food desert   are at or below the federal poverty rate. Furthermore, when we use this subset to take out outliers we only have 36 outliers and the mean changes from 26.97 to 25.42 so there is no signifcant change in removing outliers within this subset. However, within this subset after we move the outliers we can see that our   histogram is more normally distributed. With outliers our distribution is skewed to the right like it is without subsetting the data. 

```

```{r Population Normality }
#Population or POP2010 Normality Test 
summary(food$POP2010)
hist(food$POP2010, main="Histogram of Population in Tract", xlab="Population", col="red")
qqnorm(food$POP2010, main="Q-Q Plot of Tract Population")
qqline(food$POP2010)
# We can tell from our Histogram and Q-Q plot that the distributon of the population is skewed to righly skewed and does not have any since of normality. 

# Population Normality Test of only areas with Food Deserts 
hist(food.desert$POP2010, main="Histogram of Population of Tract in Food Desert", xlab="Population", col="yellow")
qqnorm(food.desert$POP2010, main="Q-Q Plot of Food Desert Population Tract")
qqline(food.desert$POP2010)
summary(food.desert$POP2010)
# When looking at the normality of the population distribution when the tract is located in a food desert the Q-Q plot seems to resemeble more of a straight line but the histogram is still slighly skewed to the right. However, the minimum, maximum, median, and mean values change significanlty when reviewing the population of a tract in a food desert versus not. 

# Finding Outliers
outlierKD2(food, POP2010, rm=FALSE)
outlierKD2(food.desert, POP2010, rm=FALSE)
# When looking at these results we can see that when we remove our outliers the data become significantly more normally distributed even though our mean with outliers is 4,270 and without otuliers the mean is 4,131. This is not a huge different but the because of the drastic shape in our histogram and bellcurve, it might be worth removing the outliers in our population variable. When looking at the outliers in locations that are considered food deserts our mean with outliers is 4,360 and without outliers is 4,254. Though with and without outliers our distribution is slightly skewed to the right it is a bit more noramlly distributed without outliers just like it is in food deserts and non-deserts. 
```

```{r Occupied Housing Normality Test}
hist(food$OHU2010, main="Histogram of Housing Units", xlab="Housing", col="orange")
qqnorm(food$OHU2010, main="Q-Q Plot of Housing Units")
qqline(food$OHU2010)
# When we are looking at our results of the total occupied housing units in the tracts we can see that the data points are righly skewed.  

# Occupied Housing Normality for only food deserts
hist(food.desert$OHU2010, main="Histogram of Housing Units in Food Deserts", xlab="Housing in Food Desert", col="pink")
qqnorm(food.desert$OHU2010, main="Q-Q Plot of Housing in Food Desert")
qqline(food.desert$OHU2010)
# When we are looking at the total occupied housing units in tracts that are classified as food deserts it seems that the distribution is still slightly skewed to the right. However, the Q-Q plot of this data is definetly more normally distributed in the subset of food desert than the whole data frame. 

# Finding Outliers 
outlierKD2(food, OHU2010, rm=FALSE)
outlierKD2(food.desert, OHU2010, rm=FALSE)
# When we look at the outliers of the data frame there are 115 total outliers and the mean with the outliers is 1,615 and without outliers the mean is 1,571 so nothing really changes by removing the outliers. Also, with and without outliers are distribution is skewed to the right. When looking at the outliers in our subset that only incldues tracts in food deserts we can see that there are only 10 outliers. The mean with the outliers is 1,605 and without outliers is 1,579 so nothing really changes by removing the outliers. However, our Q-Q plot of the subset of occupied housing units in food deserts resembles more of a straight line that the data points in the data frame. Nonetheless, the subset's distribution is still rightly-skewed. 
```

```{r Group Housing Normality Test}
summary(food$NUMGQTRS)
hist(food$NUMGQTRS, main="Histogram of Group Housing Units", xlab="Group Housing", col="dark green")
qqnorm(food$NUMGQTRS, main="Q-Q Plot of Group Housing Units")
qqline(food$NUMGQTRS)
# Group Housing units distribution is not normal. It is skewed righ, but barely skewed right. The Q-Q Plot does not even slightly resemeble a straight line. 

# Group Housing Normality for only food deserts
hist(food.desert$NUMGQTRS, main="Histogram of Group Housing Units in Food Deserts", xlab=" Group Housing in Food Desert", col="light blue ")
qqnorm(food.desert$OHU2010, main="Q-Q Plot of Housing in Food Desert")
qqline(food.desert$OHU2010)
# When we take the subset of group hosuing units only located in food deserts the distribution improves a bit more at least with our Q-Q plot. However, the histogram still resembles a right-skewed distribution. 

# Finding Outliers 
outlierKD2(food, NUMGQTRS, rm=FALSE)
outlierKD2(food.desert, NUMGQTRS, rm=FALSE)
# When we look at the group housing outliers in the data frame there are 831. The mean of the data with the outliers is 110 and without the outliers the mean is 24. This is a pretty big drop in the mean than from the other variables that we have seen, but nonetheless the data still has a right-skewed distribution and would yield the same results. When we are looking at the outliers from the subset of group housing units in food deserts the mean also has a big drop. With the outliers the mean is 200 and without outliers the mean is 42. However, the distribution is still right-skewed and would yield the same results. 

```

```{r Median Family Income Normality Test}
summary(food$MedianFamilyIncome)
hist(food$MedianFamilyIncome, main="Histogram of Median Family Income", col="dark blue")
qqnorm(food$MedianFamilyIncome, main="Q-Q Plot of Median Family Income")
qqline(food$MedianFamilyIncome)
# The median family income for the data frame is right-skewed. Though the Q-Q plot resembles a straight line representing some type of normality in the distribution. 

# Median Family Income of only Food Deserts 
hist(food.desert$MedianFamilyIncome, main="Histogram of Median Family Income in Food Deserts", col="dark red")
qqnorm(food.desert$MedianFamilyIncome, main="Q-Q Plot of Median Family Income in Food Deserts")
qqline(food.desert$MedianFamilyIncome)
# When looking at the distribution of the median family income for tracts that are located in food deserts again we can see that the distribution is right-skewed or positive. The Q-Q plot does resemble a striaght line showcasing a resembles of a normal distribution. 

#Finding Outliers 
outlierKD2(food, MedianFamilyIncome, rm=FALSE)
outlierKD2(food.desert, MedianFamilyIncome, rm=FALSE)
#By removing the outliers from our data frame and the subset that only includes food deserts nothing changes and our distribution is still right-skewed.  
```


```{r Low-Income Population Normality Test}
summary(food$TractLOWI)
hist(food$TractLOWI, main="Histogram of Low-Income Population", col="light green")
qqnorm(food$TractLOWI, main="Q-Q Plot of Low-Income Population")
qqline(food$TractLOWI)
# The low-income population for the data frame is right-skewed. The Q-Q plot resembles reflects the histogram's distribution and is right-skewed or positive.

# Low-Income Population of only Food Deserts 
hist(food.desert$TractLOWI, main="Histogram of Low-Income Population in Food Deserts", col="red")
qqnorm(food.desert$TractLOWI, main="Q-Q Plot of   Low-Income Population in Food Deserts")
qqline(food.desert$TractLOWI)
# The low-income population for the subset of food deserts is right-skewed. The Q-Q plot resembles reflects the histogram's distribution and is right-skewed or positive.

#Finding Outliers 
outlierKD2(food, TractLOWI, rm=FALSE)
outlierKD2(food.desert, TractLOWI, rm=FALSE)
#By removing the outliers from our data frame and the subset that only includes food deserts nothing changes and our distribution is still right-skewed.  
```

```{r Kid Count Normality Test}
hist(food$TractKids, main="Histogram of Kid Count", col="purple")
qqnorm(food$TractKids, main="Q-Q Plot of Kid Count in Tract")
qqline(food$TractKids)
# The number of kids in a census tract for the data frame is right-skewed. The Q-Q plot resembles  the histogram's distribution and is right-skewed or positive.

# Kid Count of only Food Deserts 
hist(food.desert$TractKids, main="Histogram of Kid Count in Food Deserts", col="yellow")
qqnorm(food.desert$TractKids, main="Q-Q Plot of Kid Count Population in Food Deserts")
qqline(food.desert$TractKids)
# The kid count for the subset of food deserts is right-skewed. The Q-Q plot resembles  the histogram's distribution and is right-skewed or positive.

#Finding Outliers 
outlierKD2(food, TractKids, rm=FALSE)
outlierKD2(food.desert, TractKids, rm=FALSE)
#By removing the outliers from our data frame and the subset that only includes food deserts nothing changes and our distribution is still right-skewed.  
```

```{r Senior Count Normality Test}
hist(food$TractSeniors, main="Histogram of Seniors in Tract", col="brown")
qqnorm(food$TractSeniors, main="Q-Q Plot of Seniors in Tract")
qqline(food$TractSeniors)
# The number of seniors in  the data frame is right-skewed. The Q-Q plot resembles the histogram's distribution and is right-skewed or positive.

# Low-Income Population of only Food Deserts 
hist(food.desert$TractSeniors, main="Histogram of Seniors in Food Deserts", col="pink")
qqnorm(food.desert$TractSeniors, main="Q-Q Plot of Seniors in Food Deserts")
qqline(food.desert$TractSeniors)
# The number of seniors for the subset of food deserts is right-skewed. The Q-Q plot resembles the histogram's distribution and is right-skewed or positive.

#Finding Outliers 
outlierKD2(food, TractSeniors, rm=FALSE)
outlierKD2(food.desert, TractSeniors, rm=FALSE)
#By removing the outliers from our data frame and the subset that only includes food deserts nothing changes and our distribution is still right-skewed.  
```


```{r White Population Normality Test}
summary(food$TractWhite)
hist(food$TractWhite, main="Histogram of White Population", col="orange")
qqnorm(food$TractWhite, main="Q-Q Plot of White Population")
qqline(food$TractWhite)
# The white population for the data frame is right-skewed. The Q-Q plot resembles the histogram's distribution and is right-skewed or positive.

# White Populatin in only Food Deserts 
hist(food.desert$TractWhite, main="Histogram of White Population in Food Deserts", col="dark green")
qqnorm(food.desert$TractWhite, main="Q-Q Plot of White Population in Food Deserts")
qqline(food.desert$TractWhite)
# The white population for the subset of food deserts is right-skewed. The Q-Q plot resembles reflects the histogram's distribution and is right-skewed or positive.

#Finding Outliers 
outlierKD2(food, TractLOWI, rm=FALSE)
outlierKD2(food.desert, TractLOWI, rm=FALSE)
#By removing the outliers from our data frame and the subset that only includes food deserts nothing changes and our distribution is still right-skewed.  
```


```{r Black Population Normality Test}
hist(food$TractBlack, main="Histogram of Black Population", col="dark red")
qqnorm(food$TractBlack, main="Q-Q Plot of Black Population")
qqline(food$TractBlack)
# The black population for the data frame is right-skewed. The Q-Q plot resembles the histogram's distribution and is right-skewed or positive.

# Black Population of only Food Deserts 
hist(food.desert$TractBlack, main="Histogram of Black Population in Food Deserts", col="red")
qqnorm(food.desert$TractBlack, main="Q-Q Plot of Black Population in Food Deserts")
qqline(food.desert$TractBlack)
# The black population for the subset of food deserts is right-skewed. The Q-Q plot resembles the histogram's distribution and is right-skewed or positive.

#Finding Outliers 
outlierKD2(food, TractBlack, rm=FALSE)
outlierKD2(food.desert, TractBlack, rm=FALSE)
#By removing the outliers from our data frame and the subset that only includes food deserts nothing changes and our distribution is still right-skewed.  
```

```{r Asian Population Normality Test}
hist(food$TractAsian, main="Histogram of Asian Population", col="dark orange")
qqnorm(food$TractAsian, main="Q-Q Plot of Asian Population")
qqline(food$TractAsian)
# The Asian population for the data frame is right-skewed. The Q-Q plot resembles the histogram's distribution and is right-skewed or positive.

# Asian Population of only Food Deserts 
hist(food.desert$TractAsian, main="Histogram of Asian Population in Food Deserts", col="green")
qqnorm(food.desert$TractAsian, main="Q-Q Plot of Asian Population in Food Deserts")
qqline(food.desert$TractAsian)
# The Asian population for the subset of food deserts is right-skewed. The Q-Q plot resembles the histogram's distribution and is right-skewed or positive.

#Finding Outliers 
outlierKD2(food, TractAsian, rm=FALSE)
outlierKD2(food.desert, TractAsian, rm=FALSE)
#By removing the outliers from our data frame and the subset that only includes food deserts nothing changes and our distribution is still right-skewed.  
```


```{r Native Hawaiian and Pacific Islander Normality Test}
hist(food$TractNHOPI, main="Histogram of Native Hawaiian or Pacific Islander  Population", col="blue")
qqnorm(food$TractNHOPI, main="Q-Q Plot of Native Hawaiian or Pacific Islander Population")
qqline(food$TractNHOPI)
# The Native Hawaiian or Pacific Islander population for the data frame is right-skewed. The Q-Q plot resembles reflects the histogram's distribution and is right-skewed or positive.

# Native Hawaiian or Pacific Islander Population in only Food Deserts 
hist(food.desert$TractNHOPI, main="Histogram of Native Hawaiian or Pacific Islander Population in Food Deserts", col="light blue")
qqnorm(food.desert$TractNHOPI, main="Q-Q Plot of Native Hawaiian or Pacific Islander Population in Food Deserts")
qqline(food.desert$TractNHOPI)
# The Native Hawaiian or Pacific Islander population for the subset of food deserts is right-skewed. The Q-Q plot resembles reflects the histogram's distribution and is right-skewed or positive.

#Finding Outliers 
outlierKD2(food, TractNHOPI, rm=FALSE)
outlierKD2(food.desert, TractNHOPI, rm=FALSE)
#By removing the outliers from our data frame and the subset that only includes food deserts nothing changes and our distribution is still right-skewed.  
```

```{r American Indian and Alaskan Native Population Normality Test}
hist(food$TractAIAN, main="Histogram of American Indian and Alaskan Native Population", col="orange")
qqnorm(food$TractAIAN, main="Q-Q Plot of American Indian and Alaskan Native Population")
qqline(food$TractAIAN)
# The American Indian and Alaskan Native populatio for the data frame is right-skewed. The Q-Q plot resembles the histogram's distribution and is right-skewed or positive.

# American Indian and Alaskan Native Population in only Food Deserts 
hist(food.desert$TractAIAN, main="Histogram of American Indian and Alaskan Native Population in Food Deserts", col="red")
qqnorm(food.desert$TractAIAN, main="Q-Q Plot of American Indian and Alaskan Native Population in Food Deserts")
qqline(food.desert$TractAIAN)
# The American Indian and Alaskan Native population for the subset of food deserts is right-skewed. The Q-Q plot resembles the histogram's distribution and is right-skewed or positive.

#Finding Outliers 
outlierKD2(food,TractAIAN , rm=FALSE)
outlierKD2(food.desert, TractAIAN, rm=FALSE)
#By removing the outliers from our data frame and the subset that only includes food deserts nothing changes and our distribution is still right-skewed.
```

```{r Multiple race/other race population Normality Test}
hist(food$TractOMultir, main="Histogram of Multiple race/other race population", col="orange")
qqnorm(food$TractOMultir, main="Q-Q Plot of Multiple race/other race population")
qqline(food$TractOMultir)


hist(food.desert$TractOMultir, main="Histogram of Multiple race/other race population in Food Deserts", col="red")
qqnorm(food.desert$TractOMultir, main="Q-Q Plot of Multiple race/other race population in Food Deserts")
qqline(food.desert$TractOMultir)


#Finding Outliers 
outlierKD2(food,TractAIAN,rm=FALSE)
outlierKD2(food.desert, TractAIAN, rm=FALSE)

```

```{r Hispanic or Latinx population Normality Test}
hist(food$TractHispanic, main="Histogram of Hispanic or Latinx population", col="orange")
qqnorm(food$TractHispanic, main="Q-Q Plot of Hispanic or Latinx population")
qqline(food$TractHispanic)


hist(food.desert$TractHispanic, main="Histogram of Hispanic or Latinx population in Food Deserts", col="red")
qqnorm(food.desert$TractHispanic, main="Q-Q Plot of Hispanic or Latinx population in Food Deserts")
qqline(food.desert$TractHispanic)


#Finding Outliers 
outlierKD2(food,TractHispanic,rm=FALSE)
outlierKD2(food.desert, TractHispanic, rm=FALSE)

```

```{r Housing units without access to a vehicle Normality Test}
hist(food$TractHUNV, main="Histogram of housing units without access to a vehicle", col="orange")
qqnorm(food$TractHUNV, main="Q-Q Plot of housing units without access to a vehicle")
qqline(food$TractHUNV)


hist(food.desert$TractHUNV, main="Histogram of housing units without access to a vehicle in Food Deserts", col="red")
qqnorm(food.desert$TractHUNV, main="Q-Q Plot of housing units without access to a vehicle in Food Deserts")
qqline(food.desert$TractHUNV)


#Finding Outliers 
outlierKD2(food,TractHUNV,rm=FALSE)
outlierKD2(food.desert, TractHUNV, rm=FALSE)

```

```{r housing units receiving SNAP benefits Normality Test}
hist(food$TractSNAP, main="Histogram of housing units receiving SNAP benefits", col="orange")
qqnorm(food$TractSNAP, main="Q-Q Plot of housing units receiving SNAP benefits")
qqline(food$TractSNAP)


hist(food.desert$TractSNAP, main="Histogram of housing units receiving SNAP benefits in Food Deserts", col="red")
qqnorm(food.desert$TractSNAP, main="Q-Q Plot of housing units receiving SNAP benefits in Food Deserts")
qqline(food.desert$TractSNAP)


#Finding Outliers 
outlierKD2(food,TractSNAP,rm=FALSE)
outlierKD2(food.desert,TractSNAP, rm=FALSE)

```

To make the results of normality test more clear, we tried an another method, K-S test
```{R Kolmogorov-Smirnov Test}
ks.test(food$PovertyRate+runif(length(food$PovertyRate),-0.05,0.05),"pnorm",mean=mean(food$PovertyRate),sd=sd(food$PovertyRate))

ks.test(food$POP2010+runif(length(food$POP2010),-0.05,0.05),"pnorm",mean=mean(food$POP2010),sd=sd(food$POP2010))

ks.test(food$OHU2010+runif(length(food$OHU2010),-0.05,0.05),"pnorm",mean=mean(food$OHU2010),sd=sd(food$OHU2010))

ks.test(food$NUMGQTRS+runif(length(food$NUMGQTRS),-0.05,0.05),"pnorm",mean=mean(food$NUMGQTRS),sd=sd(food$NUMGQTRS))

ks.test(food$MedianFamilyIncome+runif(length(food$MedianFamilyIncome),-0.05,0.05),"pnorm",mean=mean(food$MedianFamilyIncome),sd=sd(food$MedianFamilyIncome))

ks.test(food$TractLOWI+runif(length(food$TractLOWI),-0.05,0.05),"pnorm",mean=mean(food$TractLOWI),sd=sd(food$TractLOWI))

ks.test(food$TractKids+runif(length(food$TractKids),-0.05,0.05),"pnorm",mean=mean(food$TractKids),sd=sd(food$TractKids))

ks.test(food$TractSeniors+runif(length(food$TractSeniors),-0.05,0.05),"pnorm",mean=mean(food$TractSeniors),sd=sd(food$TractSeniors))

ks.test(food$TractWhite+runif(length(food$TractWhite),-0.05,0.05),"pnorm",mean=mean(food$TractWhite),sd=sd(food$TractWhite))

ks.test(food$TractBlack+runif(length(food$TractBlack),-0.05,0.05),"pnorm",mean=mean(food$TractBlack),sd=sd(food$TractBlack))

ks.test(food$TractAsian+runif(length(food$TractAsian),-0.05,0.05),"pnorm",mean=mean(food$TractAsian),sd=sd(food$TractAsian))

ks.test(food$TractNHOPI+runif(length(food$TractNHOPI),-0.05,0.05),"pnorm",mean=mean(food$TractNHOPI),sd=sd(food$TractNHOPI))

ks.test(food$TractAIAN+runif(length(food$TractAIAN),-0.05,0.05),"pnorm",mean=mean(food$TractAIAN),sd=sd(food$TractAIAN))

ks.test(food$TractOMultir+runif(length(food$TractOMultir),-0.05,0.05),"pnorm",mean=mean(food$TractOMultir),sd=sd(food$TractOMultir))

ks.test(food$TractHispanic+runif(length(food$TractHispanic),-0.05,0.05),"pnorm",mean=mean(food$TractHispanic),sd=sd(food$TractHispanic))

ks.test(food$TractHUNV+runif(length(food$TractHUNV),-0.05,0.05),"pnorm",mean=mean(food$TractHUNV),sd=sd(food$TractHUNV))

ks.test(food$TractSNAP+runif(length(food$TractSNAP),-0.05,0.05),"pnorm",mean=mean(food$TractSNAP),sd=sd(food$TractSNAP))

### For dataset food.desert
ks.test(food.desert$PovertyRate+runif(length(food.desert$PovertyRate),-0.05,0.05),"pnorm",mean=mean(food.desert$PovertyRate),sd=sd(food.desert$PovertyRate))

ks.test(food.desert$POP2010+runif(length(food.desert$POP2010),-0.05,0.05),"pnorm",mean=mean(food.desert$POP2010),sd=sd(food.desert$POP2010))

ks.test(food.desert$OHU2010+runif(length(food.desert$OHU2010),-0.05,0.05),"pnorm",mean=mean(food.desert$OHU2010),sd=sd(food.desert$OHU2010))

ks.test(food.desert$NUMGQTRS+runif(length(food.desert$NUMGQTRS),-0.05,0.05),"pnorm",mean=mean(food.desert$NUMGQTRS),sd=sd(food.desert$NUMGQTRS))

ks.test(food.desert$MedianFamilyIncome+runif(length(food.desert$MedianFamilyIncome),-0.05,0.05),"pnorm",mean=mean(food.desert$MedianFamilyIncome),sd=sd(food.desert$MedianFamilyIncome))

ks.test(food.desert$TractLOWI+runif(length(food.desert$TractLOWI),-0.05,0.05),"pnorm",mean=mean(food.desert$TractLOWI),sd=sd(food.desert$TractLOWI))

ks.test(food.desert$TractKids+runif(length(food.desert$TractKids),-0.05,0.05),"pnorm",mean=mean(food.desert$TractKids),sd=sd(food.desert$TractKids))

ks.test(food.desert$TractSeniors+runif(length(food.desert$TractSeniors),-0.05,0.05),"pnorm",mean=mean(food.desert$TractSeniors),sd=sd(food.desert$TractSeniors))

ks.test(food.desert$TractWhite+runif(length(food.desert$TractWhite),-0.05,0.05),"pnorm",mean=mean(food.desert$TractWhite),sd=sd(food.desert$TractWhite))

ks.test(food.desert$TractBlack+runif(length(food.desert$TractBlack),-0.05,0.05),"pnorm",mean=mean(food.desert$TractBlack),sd=sd(food.desert$TractBlack))

ks.test(food.desert$TractAsian+runif(length(food.desert$TractAsian),-0.05,0.05),"pnorm",mean=mean(food.desert$TractAsian),sd=sd(food.desert$TractAsian))

ks.test(food.desert$TractNHOPI+runif(length(food.desert$TractNHOPI),-0.05,0.05),"pnorm",mean=mean(food.desert$TractNHOPI),sd=sd(food.desert$TractNHOPI))

ks.test(food.desert$TractAIAN+runif(length(food.desert$TractAIAN),-0.05,0.05),"pnorm",mean=mean(food.desert$TractAIAN),sd=sd(food.desert$TractAIAN))

ks.test(food.desert$TractOMultir+runif(length(food.desert$TractOMultir),-0.05,0.05),"pnorm",mean=mean(food.desert$TractOMultir),sd=sd(food.desert$TractOMultir))

ks.test(food.desert$TractHispanic+runif(length(food.desert$TractHispanic),-0.05,0.05),"pnorm",mean=mean(food.desert$TractHispanic),sd=sd(food.desert$TractHispanic))

ks.test(food.desert$TractHUNV+runif(length(food.desert$TractHUNV),-0.05,0.05),"pnorm",mean=mean(food.desert$TractHUNV),sd=sd(food.desert$TractHUNV))

ks.test(food.desert$TractSNAP+runif(length(food.desert$TractSNAP),-0.05,0.05),"pnorm",mean=mean(food.desert$TractSNAP),sd=sd(food.desert$TractSNAP))

```

Here we added runif function to avoid repeat of numbers in variables, repear will lead to an error of K-S test. And since we are using random number generater from uniform distribution, it will not affect our result

In summary,  only variable 'OHU2010' and 'TractWhite' in dataset food.desert showed p-values larger than 0.05, so we can say the two variables are normally distributed but we may not conclude that the other variables here are not normally distributed directly, we still need to combine plots to make a final conclusion.


# Chapter 2.1 Exploratory Data Analysis 
### Here we are performing Chi-Square test on  to determine whether there is a relationship between the categorical variables. 
```{r Categorical Variable Analysis}
# Contigency Table of Food Deserts and Urban Tract
contable.urban <- table(food$Urban, food$Desert)
xkabledply(contable.urban, title="Contingency Table for Food Deserts in Urban Tracts")
urban.tble <- chisq.test(contable.urban)
urban.tble
urban.tble$expected
xkabledply(urban.tble$expected, title="Cross table for the Expected Frequencies of Food Deserts in Urban Tracts")
exp(urban.tble$p.value)
```

Here, we mainly focus on the output of Chi-Square test, we got test statistics of 53.899 which is larger than 3.84 (95% critical value of 1 df Chi-Square test), the corresponding p-value is lower than 0.05 obviously. Hence, we have enough evidence to reject the null hypothesis: variable 'Urban' and 'Desert' are independent.

Now, we have a good reason to keep variable 'Urban' in our model, but further investigations are needed.

```{r Categorical Variable Analysis}
# Contingency Table of Food Deserts and Geographical Region 
contable.region <- table(food$Region, food$Desert)
xkabledply(contable.region, title="Contingency Table for Food Deserts located in Geographical Regions")
region.tble <- chisq.test(contable.region)
region.tble
region.tble$expected
xkabledply(region.tble$expected, title="Cross table for the Expected Frequencies of Food Deserts in Geographical Regions")
```

Similarly,  we can conclude that variable 'Region' and 'Desert' are not independent.

```{r Categorical Variable Analysis}
# Contingency Table of Food Deserts and States
contable.state <- table(food$State, food$Desert)
xkabledply(contable.state, title="Contingency Table for Food Deserts located in U.S. States")
state.tble <- chisq.test(contable.state)
state.tble
state.tble$expected
state.tble$p.value
xkabledply(state.tble$expected, title="Cross table for the Expected Frequencies of Food Deserts in U.S. Staes")
```

### Here we are performing two-sample t test to determine if there exists a difference between groups.
```{R unpaired two-sample t test}
food_0<-subset(food,Desert==0)
food_1<-subset(food,Desert==1)
### for variable 'POP2010'
t.test(food_0$POP2010,food_1$POP2010)

### for the rest variables
t.test(food_0$OHU2010,food_1$OHU2010)
t.test(food_0$NUMGQTRS,food_1$NUMGQTRS)
t.test(food_0$PovertyRate,food_1$PovertyRate)
t.test(food_0$MedianFamilyIncome,food_1$MedianFamilyIncome)
t.test(food_0$TractLOWI,food_1$TractLOWI)
t.test(food_0$TractKids,food_1$TractKids)
t.test(food_0$TractSeniors,food_1$TractSeniors)
t.test(food_0$TractWhite,food_1$TractWhite)
t.test(food_0$TractBlack,food_1$TractBlack)
t.test(food_0$TractAsian,food_1$TractAsian)
t.test(food_0$TractNHOPI,food_1$TractNHOPI)
t.test(food_0$TractAIAN,food_1$TractAIAN)
t.test(food_0$TractOMultir,food_1$TractOMultir)
t.test(food_0$TractHispanic,food_1$TractHispanic)
t.test(food_0$TractHUNV,food_1$TractHUNV)
t.test(food_0$TractSNAP,food_1$TractSNAP)
```


TO simplify the process and protect information from dataset, we chose to use 0.01 as the significance level. Now, variable 'OHU2010' and 'POP2010', variable '$Region' and 'Urban', 
variable 'PovertyRate' and 'Urban', variable 'PovertyRate' and 'MedianFamilyIncome', variable 'POP2010' and 'NUMGQTRS' are not independent of each other. And it is not necessary for us to do the same test for the rest variables starting with 'Tract' since all of them are numbers of different group in the tract, in common sense, they are certainly not independent. Basically, we are required to remove these variables, however, if we really do that, we may only have five or six variables left in total, so, in order to proceed to model building part, we did not make big changes here, but this part will benefit optimization and future research if necessary.

food_coronly<-food[,c("Desert","POP2010","OHU2010","NUMGQTRS","PovertyRate","MedianFamilyIncome","TractLOWI","TractKids","TractSeniors","TractWhite","TractBlack","TractAsian","TractNHOPI","TractAIAN","TractOMultir","TractHispanic","TractHUNV","TractSNAP")]
cor(food_coronly)
# Chapter 3: Model Building 
## Linear Model Try
### Here we are disceting which variabels we should use in our model based on Adjusted R-Squared, Cp, BIC, and multicollinearity. 
```{r Forward Variable Selection}
# Deciding Best Varaible with Forward Selection and Subsetting
reg.10.forward <-regsubsets(Desert ~.-CensusTract-State , data = food, nvmax=19, nbest=1, method="forward")
plot(reg.10.forward, scale = "adjr2", main = "Adjusted R^2")
plot(reg.10.forward, scale = "Cp", main = "CP")
plot(reg.10.forward, scale = "bic", main = "BIC")
model_forward_adjr2<-lm(Desert~.-TractBlack,data = food)
model_forward_Cp<-lm(Desert~.-TractBlack-TractWhite,data = food)
model_forward_bic<-lm(Desert~.-TractBlack-TractWhite-OHU2010-TractKids-TractSeniors-TractNHOPI-TractOMultir,data = food)
summary(model_forward_adjr2)
summary(model_forward_Cp)
summary(model_forward_bic)

anova(model_forward_adjr2,model_forward_Cp)
anova(model_forward_adjr2,model_forward_bic)
anova(model_forward_Cp,model_forward_bic)
```

We know that the difference between model_forward_adjr2 and model_forward_Cp is TractWhite,
the summary of model_forward_adjr2 indicated that it should not be included in the mdoel, and anova() function's F test gave the same conclusion, for now, model_forward_Cp is a better choice. Then, we compared model_forward_Cp and model_forward_bic, together with result of summary of Model_forward_Cp, we can conclude that for forward selection, the variables in model_forward_Cp are good for now.

```{R Backward Variable Selection}
# Backward Selection
reg.best10.bkwd <- regsubsets(Desert~.-CensusTract-State, data= food, nvmax=19, nbest=1, method="backward")
plot(reg.best10.bkwd, scale = "adjr2", main = "Adjusted R^2")
plot(reg.best10.bkwd, scale = "Cp", main = "CP")
plot(reg.best10.bkwd, scale = "bic", main = "BIC")

model_backward_adjr2<-lm(Desert~.-TractHispanic,data = food)
model_backward_BIC<-lm(Desert~.-MedianFamilyIncome-TractAsian-TractNHOPI-TractHispanic-TractBlack-TractWhite-TractOMultir,data = food)
summary(model_backward_adjr2)
summary(model_backward_BIC)

anova(model_backward_adjr2,model_backward_BIC)
```


Cp and Adjusted R-square gave the same results, we only compare with BIC. 

Based on the results, model_backward_adjr2 is a better choice. And to make the sequential seleciton easier, we removed variable 'TractBlack', 'TractWhite' and 'TractHispanic'

```{R Sequential Variable Selection}
# Sequential Selection 
reg.best10.seq <- regsubsets(Desert~.-CensusTract-State-TractHispanic-TractBlack-TractWhite, data= food, nvmax=19, nbest=1, method="seqrep")
plot(reg.best10.seq, scale = "adjr2", main = "Adjusted R^2")
plot(reg.best10.seq, scale = "Cp", main = "CP")
plot(reg.best10.seq, scale = "bic", main = "BIC")

model_seq_adjr2<-lm(Desert~.-CensusTract-State-TractHispanic-TractBlack-TractWhite, data= food)
model_seq_BIC<-lm(Desert~.-CensusTract-State-TractHispanic-TractBlack-TractWhite-TractAsian-TractSNAP, data= food)

summary(model_seq_adjr2)
summary(model_seq_BIC)

anova(model_seq_adjr2,model_seq_BIC)
```

Cp and adjusted R-square gave the same result, so we only compare it with the model from BIC

We got a p-value larger than 0.05 from output of F test but not very obviously significant, and from summary of model_seq_adjr2, we can see that variable 'TractAsian' should be excluded. 

```{R Exhaustive Variable Selection}
reg.10.forward <-regsubsets(Desert~.-CensusTract-State, data = food, nvmax=19, nbest=1, method="exhaustive")
plot(reg.10.forward, scale = "adjr2", main = "Adjusted R^2")
plot(reg.10.forward, scale = "Cp", main = "CP")
plot(reg.10.forward, scale = "bic", main = "BIC")


#Correlation Tests on x variables and y 
cor.test(food$POP2010, food$Desert)
cor.test(food$TractBlack, food$Desert)
cor.test(food$PovertyRate, food$Desert)
cor.test(food$TractSNAP, food$Desert)
```

We tried exhaustive method here as an additional part, this method is only available when number of possible predictor variables is less than 20. It might not be very wise for us to follow the suggestions given by exhaustive method, because those variables gave significant p-values in the forward, backward and sequential selection. 


Again, we know that our variable Y is desert which is binary, logistic regression should be used, but linear models still deserve a try because it may give us some surprise about variable selection.

We did not include variable 'State' in our model because there are too many levels, it increased the difficulty for us to conclude, so we drop it in the process of plotting, but with no doubts, variable 'State' should be kept in the linear model try lm() part because with so many levels, at least some of them are significant, and this has been proved by the summary() function in the next step.

# Chapter 3.2: Logisitc Regression and Classification 
### Here we are performing a logistical regression and k-NN classifcation test to determine which variables impact whether or not a census tract is located in a food desert. 
```{r}
### Model Building
## Change variable 'Desert' to factor variable here and the new dataset is named as newfood now
newfood<-food
newfood$Desertfactor<-as.factor(newfood$Desert)
newfood<-newfood[,-8]
glm_food_int_Desert<-glm(Desert~.-CensusTract,data = food,family = "binomial")
summary(glm_food_int_Desert)

glm_newfood_fac_Desert<-glm(Desertfactor~.-CensusTract-TractHispanic-TractBlack-TractWhite-TractAsian-TractSNAP,data = newfood,family = "binomial")
summary(glm_newfood_fac_Desert)
exp(glm_newfood_fac_Desert$coefficients)

## build an empty and full generalised linear model
emptyglm<-glm(Desertfactor~1,data=newfood,family = binomial)
summary(emptyglm)

fullglm<-glm(Desertfactor~.-CensusTract,data=newfood,family = binomial)
summary(fullglm)

forwards<-step(emptyglm,scope=list(lower=formula(emptyglm),upper=formula(fullglm)),direction = "forward")
formula(forwards)
summary(forwards)
### The output of summary(forwards) indicates that variable 'TractNHOPI' has a p-value is 0.136183

forwards_2<-glm(Desertfactor ~ MedianFamilyIncome + State + Urban + TractLOWI + 
    TractHUNV + TractHispanic + TractAsian + NUMGQTRS + TractAIAN + 
    TractKids + TractSNAP + TractSeniors + POP2010 + OHU2010 + 
    PovertyRate,data=newfood,family = binomial)
summary(forwards_2)

### Backwards
backwards<-step(fullglm,scope=list(lower=formula(emptyglm),upper=formula(fullglm)),direction = "backward")
formula(backwards)
summary(backwards)

### Let's drop the variable 'TractNHOPI' based on the p-value
backwards_2<-glm(Desertfactor ~ State + Urban + POP2010 + OHU2010 + NUMGQTRS + 
    PovertyRate + MedianFamilyIncome + TractLOWI + TractKids + 
    TractSeniors + TractAsian + TractAIAN + TractHispanic + 
    TractHUNV + TractSNAP,data=newfood,family = binomial)
summary(backwards_2)

forwards_2$deviance;backwards_2$deviance
### the two models gave the same deviance, hence backwards_2 is our best generalized linear model for now

### Multicollinearity
vif(backwards_2)

plot(newfood$Desertfactor,predict(backwards_2))

plot(backwards_2)

### back2_logit<-glm(Desertfactor~State + Urban + POP2010 + OHU2010 + NUMGQTRS + 
###    PovertyRate + MedianFamilyIncome + TractLOWI + TractKids + 
###    TractSeniors + TractAsian + TractAIAN + TractHispanic + 
###    TractHUNV + TractSNAP,data=newfood, family = binomial(link = "logit"))
### summary(back2_logit)
###
### No improvements using logit option

### Let's remove variables according to the corrleation matrix, to simplify the process, we chose to set our criterion as 0.8
backwards_2_withoutOHU2010<-glm(Desertfactor ~ State + Urban + POP2010 + NUMGQTRS + 
    PovertyRate + MedianFamilyIncome + TractLOWI + TractKids + 
    TractSeniors + TractAsian + TractAIAN + TractHispanic + 
    TractHUNV + TractSNAP,data=newfood,family = binomial)
summary(backwards_2_withoutOHU2010)
backwards_2_withoutOHU2010$deviance

backwards_2_withoutPOP2010<-glm(Desertfactor ~ State + Urban + OHU2010 + NUMGQTRS + 
    PovertyRate + MedianFamilyIncome + TractLOWI + TractKids + 
    TractSeniors + TractAsian + TractAIAN + TractHispanic + 
    TractHUNV + TractSNAP,data=newfood,family = binomial)
summary(backwards_2_withoutPOP2010)
backwards_2_withoutPOP2010$deviance


backwards_2_withoutTkids<-glm(Desertfactor ~ State + Urban + POP2010 + OHU2010 + NUMGQTRS + 
    PovertyRate + MedianFamilyIncome + TractLOWI + TractSeniors + TractAsian + TractAIAN + TractHispanic + 
    TractHUNV + TractSNAP,data=newfood,family = binomial)
summary(backwards_2_withoutTkids)
backwards_2_withoutTkids$deviance

### Based on the deviance, the lowest one is for backwards_2_withoutTkids


### Check Assumptions of logistic regression

```

We have not changed the variable 'Desert' to factor variable until the model building part since correlation matrix will need variable 'Desert' to be numerical, and all test before gave same results for 'Desert' in factor format and numerical format.

And based on the outputs of the two models above, we saw that: No matter variable 'Desert' is numerical or categorical, we get the same results, but for stringency, we will use variable 'Desertfactor' in the dataset named as 'newfood'.

For the variable selection process, we saw multicollinearity is not good, this is an inborn disadvantage of our dataset, we have mentioned this in Chi-Square test part. Further detections are needed.



## Chapter 3.3 Heatmap
```{R Heatmap for population sum for different states}
### install.packages("usmap")
loadPkg("usmap")
dataforheatmap<-read.csv("E:/gwu/Courses/DATS 6101/project/dataforheatmap.csv")

### map for population of different states in dataset 'food'
plot_usmap(data = dataforheatmap, values = "sumpop", color = "red") + 
  scale_fill_continuous(name = "Population (2010)", label = scales::comma) + 
  theme(legend.position = "right")

### map for proportion of Desert of different states in dataset 'food'
plot_usmap(data = dataforheatmap, values = "Desertp", color = "red") + 
  scale_fill_continuous(name = "Food Desert Proportion", label = scales::comma) + 
  theme(legend.position = "right")

plot_usmap(data = dataforheatmap, values = "Desertp", labels = T, size=0.2) + labs(fill = 'Food Desert Proportion') +   scale_fill_gradientn(colours=rev(heat.colors(10)),na.value="grey90",
                       guide = guide_colourbar(barwidth = 25, barheight = 0.4,
                                               #put legend title on top of legend
                                               title.position = "top")) +theme(legend.position = "bottom",
        legend.title=element_text(size=12), 
        legend.text=element_text(size=10))

```








# Chapter 4: Conclusion 



res.aov_1 <- aov(Desert ~ Urban, data = my_data)
res.aov_2 <- aov(Desert ~ State, data = my_data)
res.aov_3 <- aov(Desert ~ Region, data = my_data)
res.aov_4 <- aov(Desert ~ OHU2010, data = my_data)
res.aov_5 <- aov(Desert ~ NUMGQTRS, data = my_data)
res.aov_6 <- aov(Desert ~ POP2010, data = my_data)
res.aov_7 <- aov(Desert ~ PovertyRate, data = my_data)
res.aov_8 <- aov(Desert ~ MedianFamilyIncome, data = my_data)
res.aov_9 <- aov(Desert ~ TractLOWI, data = my_data)
res.aov_10 <- aov(Desert ~ TractKids, data = my_data)
res.aov_11 <- aov(Desert ~ TractSenios, data = my_data)
res.aov_12 <- aov(Desert ~ TractWhite, data = my_data)
res.aov_13 <- aov(Desert ~ TractBlack, data = my_data)
res.aov_14 <- aov(Desert ~ TractAsian, data = my_data)
res.aov_15 <- aov(Desert ~ TractNHOPI, data = my_data)
res.aov_16 <- aov(Desert ~ TractAIAN, data = my_data)
res.aov_17 <- aov(Desert ~ TractOMultir, data = my_data)
res.aov_18 <- aov(Desert ~ TractHispanic, data = my_data)
res.aov_19 <- aov(Desert ~ TractHUNV, data = my_data)
res.aov_20 <- aov(Desert ~ TractSNAP, data = my_data)









